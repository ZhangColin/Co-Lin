# DDD实践纪律与能力模型

> 基于《解构领域驱动设计》系列，总结DDD实施的纪律规范和能力评估

---

## 三大纪律（最高准则）

> **纪律是关键**。方法再完美，不遵守纪律就是空谈。这三大纪律决定DDD实施的成败。

### 1. 领域专家与开发团队工作在一起

- 不是"提需求后就走"，而是**持续协作**
- 建模过程中随时沟通确认
- 共同建立和演进统一语言

### 2. 领域模型必须遵循统一语言

- 代码中的类名、方法名直接对应业务术语
- 不要技术黑话（如XxxManager、XxxHelper）
- 代码即文档，领域专家应能读懂

### 3. 时刻坚守四重设计边界

- 子域边界：核心 vs 支撑 vs 通用
- 限界上下文边界：语言边界、团队边界
- 分层边界：领域层独立于技术实现
- 聚合边界：通过ID关联，保护不变量

---

## 八项注意（设计规范）

> 针对常见偏差的固化规则，避免能力参差导致的实施偏差。

### 战略层面

**1. 子领域与限界上下文不要混为一谈**
- 子域：问题空间的分析概念
- 限界上下文：解决空间的实现单元
- 理想对应，但不强制一一对应

**2. 一个限界上下文不能由多个团队开发**
- 一个团队可以负责多个BC
- 但一个BC不能由多个团队分开发发
- 原因：语言和模型的一致性

**3. 跨进程协作通过远程服务，进程内协作通过应用服务**
- 限界上下文间：REST、gRPC、消息队列
- 限界上下文内：直接调用应用服务
- 不要在进程内搞微服务那一套

### 模型层面

**4. 保证领域分析模型、领域设计模型与领域实现模型的一致**
- 分析时画的图，设计时的类图，最后的代码
- 应该能对应上，不能割裂
- Event Storming → 设计 → 代码：一致演进

**5. 不要将领域模型暴露在应用层之外**
- 远程服务返回DTO，不返回领域对象
- 防止外部依赖领域模型的内部结构
- 保持模型演化的自由度

**6. 不要让数据模型干扰领域模型的设计**
- 先设计领域模型，再考虑持久化
- ORM只是技术手段，不能反向主导
- 数据库Schema不等于领域模型

### 战术层面

**7. 聚合之间只能通过聚合根ID引用**
- 不要聚合根实体直接持有另一个聚合根
- 通过ID引用，由资源库获取
- 保持聚合的独立性

**8. 聚合不能依赖访问外部资源的网关**
- 聚合内部不要调用资源库
- 聚合内部不要调用第三方API
- 保持聚合的纯粹性，由领域服务协调

---

## DCAM能力评估模型

> Domain-driven design Capability Assessment Model
> 
> 非认证体系，是可演化的评估框架。针对对象范式DDD。

### 维度1：敏捷迭代能力

| 层次 | 团队 | 需求 | 过程 |
|------|------|------|------|
| **初始级** | 组件团队，缺乏定期交流 | 无清晰需求管理 | 长周期，无法快速响应 |
| **成长级** | 全功能特性团队，每日站会 | 产品待办项 + 迭代待办项 | 迭代开发，定期小版本 |
| **成熟级** | 自组织团队，成员轮换 | 故事地图 + Epic/Feature/Story | 可视化看板，下游拉动 |

**关键**：DDD需要与敏捷结合，持续迭代演进领域模型。

---

### 维度2：领域建模能力

| 层次 | 建模方式 |
|------|----------|
| **初始级** | 数据建模，以数据表关系为基础 |
| **成长级** | 领域建模，少数资深人员凭经验完成 |
| **成熟级** | **Event Storming、四色建模等方法**，领域专家与开发团队共同围绕核心子域建模 |

**关键**：领域建模能力是推行DDD的基础，有别于其他软件开发方法的根本。

---

### 维度3：架构设计能力

| 层次 | 架构 | 设计 |
|------|------|------|
| **初始级** | 传统三层架构，无清晰边界 | 贫血模型 + 事务脚本 |
| **成长级** | 独立领域层 + 模块划分 | 富领域模型，但无明确聚合和资源库 |
| **成熟级** | **整洁架构** + 清晰边界（系统层次、BC层次） | **以聚合为核心**，职责合理分配给聚合、资源库、领域服务 |

**关键**：从抽象提炼（领域建模）到细化设计（架构设计），添加合理设计元素。

---

### 维度4：整洁编码能力

| 层次 | 编码 | 自动化测试 |
|------|------|------------|
| **初始级** | 只实现功能 | 无任何测试 |
| **成长级** | 遵循统一语言命名，可读性高 | 核心代码有单元测试 |
| **成熟级** | **TDD**编写领域代码，**简单设计原则** | **测试战略明确**，单元测试先行 |

**关键**：领域实现模型是最终交付物，应成为重要的企业资产。

---

## 无序设计的警告信号

> 来自Pete Goodliffe《两个系统的故事》，识别系统是否失控的信号：

1. **无明显入口**：找不到从哪儿开始理解系统
2. **无一致性**：无风格、无统一概念组织代码
3. **控制流不可预测**：难以推理程序行为
4. **代码坏味道**：像大热天的垃圾堆，散发腐烂气味
5. **数据远离使用处**：引入巴罗克式缓存层

**DDD的四重边界就是为了保证系统的有序性**。

---

## 实施建议

### 评估使用

1. 用DCAM评估团队当前成熟度
2. 识别短板，针对性培训
3. 逐步提升到成熟级

### 纪律执行

1. 将三大纪律写入团队规范
2. 代码Review时检查八项注意
3. 定期复盘，确保不偏离

### 避免僵化

- DCAM不是打分标准，是演化框架
- 八项注意可根据项目调整
- 纪律是原则，具体实践可灵活

---

**记住**：方法再好，人不执行就是空谈。DDD是一种纪律。


